<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="./css/reset.css">
    <link rel="stylesheet" href="./css/common.css">
    <title>BMI計算アプリ</title>
</head>

<body>
    <h1>BMI計算アプリ</h1>

    <section>
        <div id="app">
            <h2>UIを改善してみた</h2>
            <form @submit.prevent>
                <label>身長：<input type="text" v-model="newHeight">cm</label>
                <label>体重：<input type="text" v-model="newWeight">kg</label>
            </form>
            <br>
            <table>
                <tr>
                    <th>身長</th>
                    <th>体重</th>
                    <th>BMI</th>
                    <th>適正体重との差</th>
                </tr>
                <tr>
                    <td>{{ newHeight }}cm</td>
                    <td>{{ newWeight }}kg</td>
                    <td><span v-if="calcBmi">{{ calcBmi }}</span></td>
                    <td>{{ calcDiff }}kg</td>
            </table>
            <button @click="addItem">記録する</button>
            <br>
            <br>
            <table border="1" style="border-collapse: collapse;">
                <tr>
                    <th>日付</th>
                    <th>身長</th>
                    <th>体重</th>
                    <th>BMI</th>
                    <th>適正体重との差</th>
                </tr>
                <tr v-for="record in records">
                    <td>{{ record.date }}</td>
                    <td>{{ record.height }}</td>
                    <td>{{ record.weight }}</td>
                    <td>{{ record.bmi }}</td>
                    <td>{{ record.diff }}</td>
                </tr>
            </table>
        </div>
    </section>
    <script src="https://cdn.jsdelivr.net/npm/vue"></script>
    <script>
        var app = new Vue({
            el: '#app',
            data: {
                newHeight: '',
                newWeight: '',
                records: []
            },
            computed: {
                calcBmi: function () {
                    var calcHeight = this.newHeight / 100;
                    var bmi = Math.floor(this.newWeight / (calcHeight * calcHeight) * 10) / 10;
                    return bmi;
                },
                calcDiff: function () {
                    var diff = Math.floor((this.newWeight - ((this.newHeight / 100) * (this.newHeight / 100) * 22)) * 10) / 10;
                    if (diff > 0) {
                        diff = '+' + diff;
                    }
                    return diff;
                }
            },
            methods: {
                addItem: function () {
                    // 現在の日付を取得
                    var date = new Date();
                    var year = date.getFullYear();
                    var month = date.getMonth() + 1;
                    var day = date.getDate();

                    // プロパティと値をセット
                    var record = {
                        date: year + "/" + month + "/" + day,
                        height: this.newHeight + 'cm',
                        weight: this.newWeight + 'kg',
                        bmi: this.calcBmi,
                        diff: this.calcDiff + 'kg'
                    };

                    // recordオブジェクトをrecords配列に格納
                    this.records.push(record);
                }
            }
        })
    </script>
</body>

</html>